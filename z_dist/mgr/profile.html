<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>个人资料 - 智能旅行助手</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        accent: '#007bff',
                        danger: '#dc3545',
                        light: '#f8f9fa',
                        dark: '#343a40',
                        muted: '#6c757d',
                        card: '#f8fafc',
                        'card-hover': '#f1f5f9',
                        'text-primary': '#1e293b',
                        'text-secondary': '#475569'
                    },
                    fontFamily: {
                        sans: ['Inter', 'Microsoft Yahei', 'Arial', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 15px rgba(0, 0, 0, 0.05)',
                        'hover': '0 8px 30px rgba(0, 0, 0, 0.12)'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .gradient-bg {
                background: linear-gradient(135deg, #165DFF 0%, #36CFC9 100%);
            }
            .gradient-bg-dark {
                background: linear-gradient(135deg, #0D47A1 0%, #0097A7 100%);
            }
            .wave-bg {
                background-image: url("data:image/svg+xml,%3Csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='wave' width='100' height='10' patternUnits='userSpaceOnUse' patternContentUnits='userSpaceOnUse'%3E%3Cpath d='M0,5 Q25,10 50,5 T100,5' fill='none' stroke='rgba(255,255,255,0.1)' stroke-width='1'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='url(%23wave)'/%3E%3C/svg%3E");
            }
        }
    </style>
</head>
<body class="font-sans bg-gray-50 text-text-primary min-h-screen">
    <!-- 导航菜单 -->
    <div class="bg-white shadow-sm">
        <ul class="flex flex-wrap max-w-7xl mx-auto">
            <li class="flex-1 text-center min-w-[100px]"><a href="/mgr/index.html" class="block py-4 px-3 text-gray-700 font-medium hover:bg-primary hover:text-white transition-all duration-300">主页</a></li>
            <li class="flex-1 text-center min-w-[100px]"><a href="/mgr/travel.html" class="block py-4 px-3 text-gray-700 font-medium hover:bg-primary hover:text-white transition-all duration-300">旅行计划</a></li>
            <li class="flex-1 text-center min-w-[100px]"><a href="/mgr/ai.html" class="block py-4 px-3 text-gray-700 font-medium hover:bg-primary hover:text-white transition-all duration-300">AI助手</a></li>
            <li class="flex-1 text-center min-w-[100px]"><a href="/mgr/profile.html" class="block py-4 px-3 bg-primary text-white font-medium">个人资料</a></li>
            <li class="flex-1 text-center min-w-[100px]"><a href="#" onclick="logout()" class="block py-4 px-3 text-gray-700 font-medium hover:bg-primary hover:text-white transition-all duration-300">退出</a></li>
        </ul>
    </div>

    <!-- 封面区域 -->
    <div class="relative h-48 md:h-60 bg-gray-100 flex items-center justify-center overflow-hidden">
        <div class="text-center z-10 px-4">
            <h1 class="text-3xl md:text-4xl font-bold mb-2 text-gray-800 tracking-tight">
                <i class="fa fa-user-circle mr-2 text-primary"></i> 个人资料
            </h1>
            <p class="text-lg md:text-xl text-gray-600">
                完善您的信息，获取更个性化的旅行推荐
            </p>
        </div>
        <div class="wave-divider">
            <svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1200 120" preserveAspectRatio="none">
                <path d="M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V120H0V95.8C59.71,118.11,165.07,111.28,321.39,56.44Z" class="shape-fill" fill="#f5f7fa"></path>
            </svg>
        </div>
    </div>

    <!-- 个人资料容器 -->
    <div class="max-w-4xl mx-auto px-4 -mt-6 mb-12 relative z-10">
        <div id="success-message" class="bg-green-50 border border-green-200 text-green-700 px-6 py-4 rounded-lg mb-6 hidden items-center">
            <i class="fa fa-check-circle mr-3 text-xl"></i>
            <span></span>
        </div>
        <div id="error-message" class="bg-red-50 border border-red-200 text-red-700 px-6 py-4 rounded-lg mb-6 hidden items-center">
            <i class="fa fa-exclamation-circle mr-3 text-xl"></i>
            <span></span>
        </div>

        <!-- 基本信息卡片 -->
        <div class="bg-card rounded-xl shadow-soft p-6 mb-6 card-hover">
            <h3 class="text-xl font-semibold mb-4 pb-2 border-b border-gray-200 flex items-center text-text-primary">
                <i class="fa fa-user text-primary mr-2"></i> 基本信息
            </h3>
            <form id="profileForm">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="username" class="block text-sm font-medium text-text-secondary mb-1">用户名</label>
                        <input type="text" id="username" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all bg-gray-100" disabled>
                    </div>
                    <div>
                        <label for="email" class="block text-sm font-medium text-text-secondary mb-1">邮箱</label>
                        <input type="email" id="email" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all bg-gray-100" disabled>
                    </div>
                    <div>
                        <label for="phone" class="block text-sm font-medium text-text-secondary mb-1">电话</label>
                        <input type="tel" id="phone" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all">
                    </div>
                    <div>
                        <label for="birth_date" class="block text-sm font-medium text-text-secondary mb-1">出生日期</label>
                        <input type="date" id="birth_date" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all">
                    </div>
                </div>
                <button type="submit" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all duration-300 flex items-center shadow-md hover:shadow-lg">
                    <i class="fa fa-save mr-2"></i> 保存基本信息
                </button>
            </form>
        </div>

        <!-- 旅行偏好卡片 -->
        <div class="bg-card rounded-xl shadow-soft p-6 mb-6 card-hover">
            <h3 class="text-xl font-semibold mb-4 pb-2 border-b border-gray-200 flex items-center text-text-primary">
                <i class="fa fa-heart text-primary mr-2"></i> 旅行偏好
            </h3>
            <form id="preferenceForm">
                <div class="mb-6">
                    <label for="preferred_activities" class="block text-sm font-medium text-text-secondary mb-1">偏好的活动类型</label>
                    <textarea id="preferred_activities" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all" placeholder="例如：徒步、游泳、参观博物馆、购物等"></textarea>
                    <p class="text-xs text-text-secondary mt-1">请输入您喜欢的旅行活动类型，多个活动用逗号分隔</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="budget_range_min" class="block text-sm font-medium text-text-secondary mb-1">预算范围(最小值)</label>
                        <input type="number" id="budget_range_min" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all" placeholder="例如：1000">
                    </div>
                    <div>
                        <label for="budget_range_max" class="block text-sm font-medium text-text-secondary mb-1">预算范围(最大值)</label>
                        <input type="number" id="budget_range_max" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all" placeholder="例如：5000">
                    </div>
                </div>

                <div class="mb-6">
                    <label for="preferred_climate" class="block text-sm font-medium text-text-secondary mb-1">偏好的气候</label>
                    <input type="text" id="preferred_climate" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all" placeholder="例如：温暖、凉爽、热带等">
                </div>

                <div class="mb-6">
                    <label for="special_requirements" class="block text-sm font-medium text-text-secondary mb-1">特殊要求</label>
                    <textarea id="special_requirements" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary outline-none transition-all" placeholder="例如：无障碍设施、儿童友好、宠物友好等"></textarea>
                </div>

                <button type="submit" class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary/90 transition-all duration-300 flex items-center shadow-md hover:shadow-lg">
                    <i class="fa fa-save mr-2"></i> 保存旅行偏好
                </button>
            </form>
        </div>
    </div>

    <script>
        // 页面加载时加载用户资料
        $(document).ready(function() {
            loadUserProfile();

            // 绑定表单提交事件
            $('#profileForm').on('submit', function(e) {
                e.preventDefault();
                updateProfile();
            });

            $('#preferenceForm').on('submit', function(e) {
                e.preventDefault();
                updatePreference();
            });
        });

        // 加载用户资料
        function loadUserProfile() {
            $.ajax({
                url: "/api/travel/profile/",
                type: "GET",
                success: function(response) {
                    if (response.ret === 0) {
                        // 填充基本信息表单
                        $('#username').val(response.data.username);
                        $('#email').val(response.data.email);
                        $('#phone').val(response.data.phone || '');
                        $('#birth_date').val(response.data.birth_date || '');

                        // 填充旅行偏好表单
                        $('#preferred_activities').val(response.data.preferred_activities || '');
                        $('#budget_range_min').val(response.data.budget_range_min || '');
                        $('#budget_range_max').val(response.data.budget_range_max || '');
                        $('#preferred_climate').val(response.data.preferred_climate || '');
                        $('#special_requirements').val(response.data.special_requirements || '');
                    } else {
                        showError('获取用户资料失败: ' + response.msg);
                    }
                },
                error: function() {
                    showError('网络错误，请稍后重试');
                }
            });
        }

        // 更新基本信息
        function updateProfile() {
            var profileData = {
                phone: $('#phone').val(),
                birth_date: $('#birth_date').val()
            };

            $.ajax({
                url: "/api/travel/profile/update/",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({profile: profileData}),
                success: function(response) {
                    if (response.ret === 0) {
                        showSuccess('基本信息更新成功');
                    } else {
                        showError('基本信息更新失败: ' + response.msg);
                    }
                },
                error: function() {
                    showError('网络错误，请稍后重试');
                }
            });
        }

        // 更新旅行偏好
        function updatePreference() {
            var preferenceData = {
                preferred_activities: $('#preferred_activities').val(),
                budget_range_min: $('#budget_range_min').val() || null,
                budget_range_max: $('#budget_range_max').val() || null,
                preferred_climate: $('#preferred_climate').val(),
                special_requirements: $('#special_requirements').val()
            };

            $.ajax({
                url: "/api/travel/profile/update/",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({preference: preferenceData}),
                success: function(response) {
                    if (response.ret === 0) {
                        showSuccess('旅行偏好更新成功');
                    } else {
                        showError('旅行偏好更新失败: ' + response.msg);
                    }
                },
                error: function() {
                    showError('网络错误，请稍后重试');
                }
            });
        }

        // 显示成功消息
        function showSuccess(message) {
            $('#success-message span').text(message);
            $('#success-message').removeClass('hidden').addClass('flex');
            $('#error-message').addClass('hidden').removeClass('flex');

            // 3秒后自动隐藏
            setTimeout(function() {
                $('#success-message').addClass('hidden').removeClass('flex');
            }, 3000);
        }

        // 显示错误消息
        function showError(message) {
            $('#error-message span').text(message);
            $('#error-message').removeClass('hidden').addClass('flex');
            $('#success-message').addClass('hidden').removeClass('flex');

            // 5秒后自动隐藏
            setTimeout(function() {
                $('#error-message').addClass('hidden').removeClass('flex');
            }, 5000);
        }

        // 退出登录
        function logout() {
            if (confirm('确定要退出登录吗？')) {
                $.ajax({
                    url: "/api/mgr/signout",
                    type: "POST",
                    success: function() {
                        window.location.href = "/mgr/sign.html";
                    },
                    error: function() {
                        window.location.href = "/mgr/sign.html";
                    }
                });
            }
        }
    </script>
</body>
</html>

